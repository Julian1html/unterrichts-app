<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sch√ºlerdetails</title>

  <!-- ‚ù∂ DESIGN an Ma√üstab angelehnt -->
  <style>
    /* Hintergrund & Grundschrift */
    body{
      font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;
      background:linear-gradient(to right,#e3f2fd,#ffffff);
      margin:0;
      padding:20px;
      color:#333;
    }

    /* Zentrale Karte */
    .container{
      max-width:850px;
      margin:auto;
      background:#fff;
      padding:30px;
      border-radius:16px;
      box-shadow:0 8px 20px rgba(0,0,0,.1);
    }

    /* √úberschriften */
    h2,h3{
      margin-top:0;
      color:#1565c0;
    }

    /* Buttons (gro√ü) */
    button{
      padding:10px 15px;
      margin:10px 10px 20px 0;
      border-radius:8px;
      border:none;
      font-size:16px;
      cursor:pointer;
      transition:background .3s ease;
      background:#1565c0;
      color:#fff;
    }
    button:hover{background:#0d47a1;}

    /* L√∂sch-Buttons innerhalb Eintrag (klein) */
    button.small{
      background:none;
      color:#d32f2f;
      padding:4px 8px;
      font-size:18px;
      display:none;
    }

    /* Eingabefelder */
    input,textarea{
      width:100%;
      padding:10px 12px;
      margin-top:5px;margin-bottom:15px;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:15px;
      transition:border .2s,box-shadow .2s;
      box-sizing:border-box;
    }
    input:hover,textarea:hover{
      border-color:#1565c0;
      box-shadow:0 0 6px rgba(21,101,192,.25);
    }
    input:focus,textarea:focus{
      outline:none;
      border-color:#1565c0;
      box-shadow:0 0 6px rgba(21,101,192,.4);
    }

    /* Eintr√§ge-Box */
    .unterrichtseintrag{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      background:#e3f2fd;
      padding:16px;
      margin-bottom:12px;
      border-left:5px solid #2196f3;
      border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,.05);
    }
    .unterrichtseintrag:hover button.small{display:inline;}

    /* Pop-up */
    #popup{
      display:none;
      position:fixed;
      top:15%;
      left:50%;
      transform:translateX(-50%);
      background:#fff;
      padding:25px;
      border-radius:16px;
      box-shadow:0 8px 20px rgba(0,0,0,.25);
      z-index:1000;
      width:90%;max-width:500px;
      text-align:center;
    }
    #popup input,#popup textarea{max-width:460px;margin:auto;margin-bottom:12px;}

    /* Overlay */
    #overlay{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.4);
      z-index:999;
    }
  </style>
</head>

<body>
  <div class="container">
    <h2 id="schuelerName">Sch√ºler: ‚Ä¶</h2>

    <h3>üìù Beschreibung</h3>
    <textarea id="beschreibung" rows="3" placeholder="Beschreibe diesen Sch√ºler‚Ä¶"></textarea>
    <button onclick="beschreibungSpeichern()">üíæ Speichern</button>

    <h3>üìö Unterrichtseintr√§ge</h3>
    <div id="eintraege"></div>

    <button onclick="zeigePopup()">‚ûï Stunde hinzuf√ºgen</button>
    <button onclick="window.location.href='schueler.html'">üîô Zur√ºck zur Sch√ºlerliste</button>
  </div>

  <!-- Pop-up -->
  <div id="overlay" onclick="versteckePopup()"></div>
  <div id="popup">
    <h3>Neue Stunde hinzuf√ºgen</h3>
    <input type="date" id="datum">
    <textarea id="inhalt" rows="2" placeholder="Inhalt der Stunde"></textarea>
    <textarea id="ziel" rows="2" placeholder="Ziel f√ºr das n√§chste Mal (optional)"></textarea>
    <input type="number" id="betrag" placeholder="Betrag (‚Ç¨)">
    <button onclick="eintragHinzufuegen()">‚úÖ Speichern</button>
    <button onclick="versteckePopup()">‚ùå Abbrechen</button>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

  <script>
    /* Firebase-Setup */
    const firebaseConfig={
      apiKey:"AIzaSyAxBY3DCqSuEuivntWrxdXJP7lubL0Ri1k",
      authDomain:"unterricht-tracker-c3746.firebaseapp.com",
      projectId:"unterricht-tracker-c3746",
      storageBucket:"unterricht-tracker-c3746.appspot.com",
      messagingSenderId:"117117875760",
      appId:"1:117117875760:web:a67954a96c76abbac29ff5"
    };
    firebase.initializeApp(firebaseConfig);
    const db=firebase.firestore();

    /* DOM-Elemente */
    const nameEl=document.getElementById("schuelerName");
    const beschreibungEl=document.getElementById("beschreibung");
    const eintraegeEl=document.getElementById("eintraege");
    const params=new URLSearchParams(window.location.search);
    const schuelerId=params.get("id");
    let letztesZiel="";

    /* Daten laden */
    async function ladeDetails(){
      const doc=await db.collection("schueler").doc(schuelerId).get();
      if(!doc.exists){nameEl.textContent="Sch√ºler nicht gefunden!";return;}
      const daten=doc.data();
      nameEl.textContent="Sch√ºler: "+daten.name;
      beschreibungEl.value=daten.beschreibung||"";
      ladeEintraege();
    }

    async function beschreibungSpeichern(){
      await db.collection("schueler").doc(schuelerId)
              .update({beschreibung:beschreibungEl.value});
      alert("Beschreibung gespeichert");
    }

    /* Pop-up */
    function zeigePopup(){
      document.getElementById("datum").valueAsDate=new Date();
      document.getElementById("inhalt").value=letztesZiel;
      document.getElementById("ziel").value="";
      document.getElementById("betrag").value="";
      document.getElementById("popup").style.display="block";
      document.getElementById("overlay").style.display="block";
    }
    function versteckePopup(){
      document.getElementById("popup").style.display="none";
      document.getElementById("overlay").style.display="none";
    }

    /* Eintrag hinzuf√ºgen */
    async function eintragHinzufuegen(){
      const datum=document.getElementById("datum").value;
      const inhalt=document.getElementById("inhalt").value;
      const ziel=document.getElementById("ziel").value.trim();
      const betrag=parseFloat(document.getElementById("betrag").value);
      if(!datum||!inhalt) return;
      await db.collection("schueler").doc(schuelerId)
              .collection("eintraege").add({
        datum,inhalt,ziel,betrag:isNaN(betrag)?null:betrag,
        timestamp:new Date(datum)
      });
      letztesZiel=ziel?ziel:"";
      versteckePopup();
      ladeEintraege();
    }

    /* Eintr√§ge laden */
    async function ladeEintraege(){
      eintraegeEl.innerHTML="";
      letztesZiel="";
      const snapshot=await db.collection("schueler").doc(schuelerId)
                       .collection("eintraege")
                       .orderBy("timestamp","desc").get();
      snapshot.forEach(doc=>{
        const e=doc.data();
        if(!letztesZiel&&e.ziel) letztesZiel=e.ziel;
        const div=document.createElement("div");
        div.className="unterrichtseintrag";
        div.innerHTML=`
          <div>
            <strong>${e.datum}</strong> ‚Äì ${e.inhalt}
            ${e.ziel?`<br><em>Ziel: ${e.ziel}</em>`:""}
            ${e.betrag?`<br><small>Betrag: ‚Ç¨${e.betrag.toFixed(2)}</small>`:""}
          </div>
          <button class="small" onclick="eintragLoeschen('${doc.id}')">‚ùå</button>
        `;
        eintraegeEl.appendChild(div);
      });
    }

    async function eintragLoeschen(id){
      if(confirm("Eintrag wirklich l√∂schen?")){
        await db.collection("schueler").doc(schuelerId)
                .collection("eintraege").doc(id).delete();
        ladeEintraege();
      }
    }

    ladeDetails();
  </script>
</body>
</html>
